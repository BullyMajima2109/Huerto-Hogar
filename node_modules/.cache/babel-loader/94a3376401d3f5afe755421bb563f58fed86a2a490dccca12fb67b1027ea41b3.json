{"ast":null,"code":"import _objectSpread from\"C:/Users/jorda/OneDrive/Escritorio/William/huerto-hogar-react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/components/CheckoutPage.jsx\nimport{useState,useMemo}from'react';import{Button,Card,Table,Alert,Spinner}from'react-bootstrap';import{ordenesAPI}from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function CheckoutPage(_ref){let{cart,onBack,onConfirm}=_ref;const[submitting,setSubmitting]=useState(false);const[error,setError]=useState('');const detailedItems=useMemo(()=>cart.map(item=>_objectSpread(_objectSpread({},item),{},{subtotal:(item.price||0)*item.qty})),[cart]);const total=detailedItems.reduce((sum,item)=>sum+item.subtotal,0);const hasItems=detailedItems.length>0;const handleConfirmPurchase=async()=>{if(!hasItems)return;const itemsWithIds=detailedItems.filter(item=>item.id);if(itemsWithIds.length!==detailedItems.length){setError('Hay productos que no tienen un ID v√°lido. Vuelve al cat√°logo e intenta agregar nuevamente.');return;}setSubmitting(true);setError('');try{const itemsForBackend=itemsWithIds.map(item=>({productoId:item.id,cantidad:item.qty}));const orden=await ordenesAPI.create(itemsForBackend);await ordenesAPI.confirmar(orden.id);onConfirm(orden.numeroOrden);}catch(err){setError(err.message||'Error al confirmar la compra. Intenta nuevamente.');console.error('Error:',err);}finally{setSubmitting(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center mt-4\",children:/*#__PURE__*/_jsx(Card,{style:{maxWidth:'700px',width:'100%'},className:\"shadow-sm\",children:/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"mb-3\",children:\"\\uD83E\\uDDFE Boleta de compra\"}),error&&/*#__PURE__*/_jsx(Alert,{variant:\"danger\",children:error}),!hasItems&&/*#__PURE__*/_jsx(\"p\",{className:\"text-muted\",children:\"No hay productos en el carrito. Vuelve al cat\\xE1logo para agregar productos.\"}),hasItems&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Table,{bordered:true,size:\"sm\",className:\"mb-3\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Producto\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Cantidad\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Precio\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Subtotal\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:detailedItems.map((item,idx)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.name}),/*#__PURE__*/_jsx(\"td\",{children:item.qty}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$\",item.price.toLocaleString('es-CL')]}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$\",item.subtotal.toLocaleString('es-CL')]})]},idx))}),/*#__PURE__*/_jsx(\"tfoot\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{colSpan:3,className:\"text-end fw-bold\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"td\",{className:\"fw-bold\",children:[\"$\",total.toLocaleString('es-CL')]})]})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"small text-muted\",children:[\"Gracias por comprar en \",/*#__PURE__*/_jsx(\"strong\",{children:\"Huerto Hogar\"}),\". Esta es una boleta simulada para fines de evaluaci\\xF3n.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between mt-3\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline-secondary\",onClick:onBack,disabled:submitting,children:\"\\u2B05 Volver al cat\\xE1logo\"}),/*#__PURE__*/_jsx(Button,{variant:\"success\",disabled:!hasItems||submitting,onClick:handleConfirmPurchase,children:submitting?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Spinner,{animation:\"border\",size:\"sm\",className:\"me-2\"}),\"Procesando...\"]}):'‚úÖ Confirmar compra'})]})]})})});}","map":{"version":3,"names":["useState","useMemo","Button","Card","Table","Alert","Spinner","ordenesAPI","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CheckoutPage","_ref","cart","onBack","onConfirm","submitting","setSubmitting","error","setError","detailedItems","map","item","_objectSpread","subtotal","price","qty","total","reduce","sum","hasItems","length","handleConfirmPurchase","itemsWithIds","filter","id","itemsForBackend","productoId","cantidad","orden","create","confirmar","numeroOrden","err","message","console","className","children","style","maxWidth","width","Body","Title","variant","bordered","size","idx","name","toLocaleString","colSpan","onClick","disabled","animation"],"sources":["C:/Users/jorda/OneDrive/Escritorio/William/huerto-hogar-react/src/components/CheckoutPage.jsx"],"sourcesContent":["// src/components/CheckoutPage.jsx\r\nimport { useState, useMemo } from 'react';\r\nimport { Button, Card, Table, Alert, Spinner } from 'react-bootstrap';\r\nimport { ordenesAPI } from '../services/api';\r\n\r\nexport default function CheckoutPage({ cart, onBack, onConfirm }) {\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const detailedItems = useMemo(\r\n    () =>\r\n      cart.map((item) => ({\r\n        ...item,\r\n        subtotal: (item.price || 0) * item.qty,\r\n      })),\r\n    [cart]\r\n  );\r\n\r\n  const total = detailedItems.reduce((sum, item) => sum + item.subtotal, 0);\r\n  const hasItems = detailedItems.length > 0;\r\n\r\n  const handleConfirmPurchase = async () => {\r\n    if (!hasItems) return;\r\n\r\n    const itemsWithIds = detailedItems.filter((item) => item.id);\r\n    if (itemsWithIds.length !== detailedItems.length) {\r\n      setError('Hay productos que no tienen un ID v√°lido. Vuelve al cat√°logo e intenta agregar nuevamente.');\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    setError('');\r\n\r\n    try {\r\n      const itemsForBackend = itemsWithIds.map((item) => ({\r\n        productoId: item.id,\r\n        cantidad: item.qty,\r\n      }));\r\n\r\n      const orden = await ordenesAPI.create(itemsForBackend);\r\n      await ordenesAPI.confirmar(orden.id);\r\n\r\n      onConfirm(orden.numeroOrden);\r\n    } catch (err) {\r\n      setError(err.message || 'Error al confirmar la compra. Intenta nuevamente.');\r\n      console.error('Error:', err);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"d-flex justify-content-center mt-4\">\r\n      <Card style={{ maxWidth: '700px', width: '100%' }} className=\"shadow-sm\">\r\n        <Card.Body>\r\n          <Card.Title className=\"mb-3\">üßæ Boleta de compra</Card.Title>\r\n\r\n          {error && <Alert variant=\"danger\">{error}</Alert>}\r\n\r\n          {!hasItems && (\r\n            <p className=\"text-muted\">\r\n              No hay productos en el carrito. Vuelve al cat√°logo para agregar productos.\r\n            </p>\r\n          )}\r\n\r\n          {hasItems && (\r\n            <>\r\n              <Table bordered size=\"sm\" className=\"mb-3\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Producto</th>\r\n                    <th>Cantidad</th>\r\n                    <th>Precio</th>\r\n                    <th>Subtotal</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {detailedItems.map((item, idx) => (\r\n                    <tr key={idx}>\r\n                      <td>{item.name}</td>\r\n                      <td>{item.qty}</td>\r\n                      <td>${item.price.toLocaleString('es-CL')}</td>\r\n                      <td>${item.subtotal.toLocaleString('es-CL')}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n                <tfoot>\r\n                  <tr>\r\n                    <td colSpan={3} className=\"text-end fw-bold\">\r\n                      Total\r\n                    </td>\r\n                    <td className=\"fw-bold\">\r\n                      ${total.toLocaleString('es-CL')}\r\n                    </td>\r\n                  </tr>\r\n                </tfoot>\r\n              </Table>\r\n\r\n              <p className=\"small text-muted\">\r\n                Gracias por comprar en <strong>Huerto Hogar</strong>.\r\n                Esta es una boleta simulada para fines de evaluaci√≥n.\r\n              </p>\r\n            </>\r\n          )}\r\n\r\n          <div className=\"d-flex justify-content-between mt-3\">\r\n            <Button variant=\"outline-secondary\" onClick={onBack} disabled={submitting}>\r\n              ‚¨Ö Volver al cat√°logo\r\n            </Button>\r\n\r\n            <Button\r\n              variant=\"success\"\r\n              disabled={!hasItems || submitting}\r\n              onClick={handleConfirmPurchase}\r\n            >\r\n              {submitting ? (\r\n                <>\r\n                  <Spinner animation=\"border\" size=\"sm\" className=\"me-2\" />\r\n                  Procesando...\r\n                </>\r\n              ) : (\r\n                '‚úÖ Confirmar compra'\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </Card.Body>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}